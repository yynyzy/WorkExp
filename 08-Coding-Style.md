# Coding Style

认真对待每一行代码，保持代码风格一致，保持代码干净整洁！

## 通用

### 空格与空行

一般原则：

- 逗号后空格。
- 注释标记后空格。
- 操作符前后空格。
- 方法调用的括号前后不空格。
- 缩进使用空格而不是 Tab。
- 20 行以内的小方法尽量不要加空行。
- 一般一次只空一行，任何多余的空行提交前都应删除。

### 列数

所有语言每行不得超过 120 列。

### 引号

优先级：无引号 > 单引号 > 双引号

### 字符串

插值语法 > 运算符连接

### 命名

- 遵循术语表。
- 遵守英语语法。
- 遵守语言惯例。

### 结构

- 尽量按最小原则来公开成员变量。
- 局部变量最好就近声明。
- 使用中间变量增加可读性。
- 条件分支要凸显差异，结构尽量加紧凑。

### 注释

首先要保证最可读的代码，有情况要求再写注释。

临时标记注释：TODO（待实现）、FIXME（待修复）、HACK（特殊处理）、OPTIMIZE（待优化）、REVIEW（评审后的评论）等。

### 异常

- 不要吞掉异常（错误）。
- 不要过度处理异常（错误）。
- 保留原始异常（错误）。
- 所用语言支持异常时，尽量不要用返回值表示成功和失败。
- 若要重试，必须加次数限制，应做好统一封装。

### 性能

尽量优化算法，保证高效使用内存、数据库，涉及数据量处理，以最坏的情况做打算。

数据库基本优化思路：

- 在数据库中预先筛选数据，减少不必要的计算。
- 缓存、复用结果，减少重复的开销。
- 使用高效数据结构，空间换时间。
- 合理使用索引。

## HTML/CSS Style

### General Style Rules

- Protocol。

    尽可能使用 HTTPS 作为图片，媒体链接等的协议。

- Indentation。

    标签缩进两个空格，不要使用 tab。

    ```html
    <ul>
      <li></li>
      <li></li>
    <ul/>
    ```

- Capitalization。

    请使用小写，无论是 HTML 元素、CSS 选择器等。

- Trailing Whitespace。

    不要在行位有尾随空格。

### General Meta Rules

- 确保编辑器使用 UTF-8 作为字符编码。
- 尽可能的根据需要解释代码，使用注释解释它的作用目的。
- 字符编码必须在文档的前 1024 个字节内。

### HTML Style Rules

- 使用包含连字符的 id。当元素具有 id 属性时，浏览器会将其作为全局窗口原型上的命名属性提供，这可能会导致意外行为。包含连字符的 id 不能作为全局 JavaScript 变量引用。
- 省略样式表和脚本的类型属性。因为 HTML5 暗示 text/css 和 text/javascript 作为默认值。
- 使用外部链接时，添加 rel="noopener" 与 target="_blank" 两个属性来提高安全性。
- 布尔属性值，如禁用 disabled 等多余的，必须省略。
- 对于 images，videos 等媒体对象，添加 alt 属性来提供替代访问的文字说明。
- images 必须声明 width 和 height。
- 将结构、样式和行为严格分开，保持最低限度交互。
- 使用 HTML5，尽可能使用有效的 HTMl。
- 根据目的使用 HTML 标签，尽量语义化。
- 单行注释必须在内容前后有空行。
- 锚点链接必须有 title 属性。
- 属性名称必须小写。

### HTML Formatting Rules

- HTML 语句过长可以考虑换行提高可读性，每个续行从原始行缩进至少 2 个额外的空格，以区分被包裹的属性和子元素。
- 为每个块、列表或表格元素使用一个新行，并缩进每个这样的子元素。

## CSS Style Rules

- 使用有效的 CSS，使用有意义的或通用的类名，能反映相关元素用途的类名，帮助理解。
- 在规则声明中使用多个选择器时，请为每个选择器单独指定一行。
- 多个单词的类名使用 hyphen 进行链接，不要使用下划线。
- 在属性中，在 : 字符之后而不是之前放置一个空格。
- 对属性选择器和属性值使用单引号而不是双引号。
- 出于性能原因，避免不必要的祖先选择器。
- 使用类名选择器比使用 id 选择器更好。
- 除非需要，否则在 0 值后省略单位。
- 每一个元素属性声明后使用分号。
- 用新行分隔选择器和声明。
- 不要使用 !important。
- 避免使用行内样式。

## JavaScript Rules

- 必须在关闭 body 标签之前加载外部 JavaScript 文件。
- Script 中 type="text/javascript" 属性需要忽略。

### 类型

- 在针对本身不支持它们的浏览器/环境时不应使用 Symbols 和 BigInt 类型。
- 尽可能使用 const 与 let 来声明变量。

### 对象

- 使用字面量语法创建对象。
- 在创建具有动态属性名称的对象时使用计算属性名称。

    在 ES6 中，把属性名用 [] 括起来，则括号中就可以引用提前定义的变量。

    ```javascript
    var attName = 'name';
        var p = {
            [attName] : 'abc'，  // 引用了变量attName。相当于添加了一个属性名为name的属性
            age : 20
        }
        console.log(p[attName])  // abc
    ```

- 不要 Object.prototype 直接调用方法。

    例如 hasOwnProperty 可能会被相关对象的属性所遮蔽，如 { hasOwnProperty: false } 或该对象可能是空对象 (Object.create(null))。

    ```javascript
    // bad
    console.log(object.hasOwnProperty(key));

    // good
    console.log(Object.prototype.hasOwnProperty.call(object， key));

    // best
    const has = Object.prototype.hasOwnProperty;
    console.log(has.call(object， key));
    ```

### 数组

- 使用字面量语法创建数组。
- 使用 Array.push 而不是直接赋值添加到数组中。
- 使用数组扩展 ... 来复制数组。
- 使用展开运算符 ... 而不是 Array.from 来将可迭代对象转换为数组。
- 使用用于 Array.from 将类数组对象转换为数组。

### 解构

- 在访问和使用对象的多个属性时使用对象解构。

    解构使您免于为这些属性创建临时引用，并免于重复访问对象。

- 对多个返回值使用对象解构，而不是数组解构。

### 字符串

- 对字符串使用单引号 ''。
- 字符串拼接使用模板字符串而不是串联。

### 函数

- 使用命名函数表达式而不是函数声明。
- 函数中不要使用 arguments，选择使用 rest 语法 ... 。
- 函数参数使用默认参数语法而不是改变函数参数。
- 不要改变参数或者重新分配参数。
- 推荐使用扩展语法 ... 来调用可变参数函数。

### 箭头函数

- 使用匿名函数时如传递内联回调，使用箭头函数。
- 如果函数体由单个语句组成，返回一个没有副作用的表达式，省略大括号并使用隐式返回。否则保留大括号并使用 return 语句。

### 类和构造函数

- 使用 class 代替 prototype，避免 prototype 直接操作。
- 方法可以返回 this 以使方法可以接连使用。

    ```javascript
    // good
    class Jedi {
      jump() {
        this.jumping = true;
        return this;
      }

      setHeight(height) {
        this.height = height;
        return this;
      }
    }

    const luke = new Jedi();

    luke.jump()
      .setHeight(20);
    ```

### 模块

- 始终使用模块 import 与 export。
- 不要使用通配符引入。
- 不要导出可变绑定，通常只应导出常量引用。

    ```javascript
    // good
    const foo = 3;
    export { foo };
    ```

- import 语句应该放在最顶上。

### 变量

- 使用 const 与 let，并对所有的 const 与 let 进行分组。
- 不要连接变量赋值。
- 不要使用 ++ 和 -- 来进行递增递减。

### 比较运算符

- 使用 === 和 !== 代替 == 和 != 。
- 转换布尔值遵循以下一般规则：

    ```text
    Objects = true
    Undefined = false
    Null = false
    Booleans = 它们的值
    Numbers 除了 +0、-0、NaN 为 false，其他都为 true。
    Strings 除了空字符串为 false， 其他都为 true。
    ```

- 三元运算符语句通常是单行表示，避免不必要的三元语句。

### 注释

- 使用 `/* ... */` 为多行注释。
- 使用 // 为单行注释。将单行注释放在注释主题上方的换行符上。除非它在块的第一行，否则在注释前放置一个空行。
- 所有注释都应该空一格再写注释。
- 为您的注释添加前缀 FIXME 或 TODO 帮助其他开发人员快速了解您是否指出需要重新审视的问题。

### 空白

- 使用软制表符（空格字符）设置为 2 个空格。
- 在使用长方法链（超过 2 个方法链）时使用缩进。使用前导点，强调该行是方法调用，而不是新语句。
- 用空格分隔运算符。
- 一般不要使用空行来填充你的代码，必要的时候可以使用空行。
- 不要再括号内添加空格，在花括号内添加空格。

### 命名约定

- 避免使用单字母名称。
- 在命名对象、函数和实例时使用驼峰命名法。
- 仅在命名构造函数或类时使用帕斯卡命名法。
- 文件名应与其默认导出的名称完全匹配

## Java Rules

### 命名风格

- 强制
    - 类名使用 UpperCamelCase 风格，以下情形例外:DO / PO / DTO / BO / VO / UID 等。
    - 方法名、参数名、成员变量、局部变量都统一使用 lowerCamelCase 风格。
    - 包名用全小写字母命名。
    - 常量命名应该全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。
    - 抽象类命名使用 Abstract 或 Base 开头;异常类命名使用 Exception 结尾，测试类命名以它要测试的类的名称开始，以 Test 结尾。
    - POJO 类中的任何布尔类型的变量，都不要加 is 前缀，否则部分框架解析会引起序列化错误。
    - 包名统一使用小写，点分隔符之间有且仅有一个自然语义的英语单词。包名统一使用单数形式，但是类名如果有复数含义，类名可以使用复数形式。
    - 避免在子父类的成员变量之间、或者不同代码块的局部变量之间采用完全相同的命名，使可理解性降低。
- 推荐
    - 在常量与变量命名时，表示类型的名词放在词尾，以提升辨识度。
    - 如果模块、接口、类、方法使用了设计模式，在命名时要体现出具体模式。
    - 接口类中的方法和属性不要加任何修饰符号(public 也不要加)，保持代码的简洁性，并加上有效的 Javadoc 注释。
    - 尽量不要在接口里定义常量，如果一定要定义，最好确定该常量与接口的方法相关，并且是整个应用的基础常量。
    - 接口和实现类的命名有两套规则:
        - 对于 Service 和 DAO 类，基于 SOA 的理念，暴露出来的服务一定是接口，内部的实现类用 Impl 的后缀与接口区别。
        - 如果是形容能力的接口名称，取对应的形容词为接口名(通常是 –able 结尾的形容词)。
- 参考
    - 枚举类名带上 Enum 后缀，枚举成员名称需要全大写，单词间用下划线隔开。
    - 各层命名规约:
        - Service / DAO 层方法命名规约:
            - 获取单个对象的方法用 get 做前缀。
            - 获取多个对象的方法用 list 做前缀，复数结尾，如:listObjects
            - 获取统计值的方法用 count 做前缀。
            - 插入的方法用 save / insert 做前缀。
            - 删除的方法用 remove / delete 做前缀。
            - 修改的方法用 update 做前缀。
        - 领域模型命名规约:
            - 数据对象:xxxDO，xxx 即为数据表名。
            - 数据传输对象:xxxDTO，xxx 为业务领域相关的名称。
            - 展示对象:xxxVO，xxx 一般为网页名称。
            - POJO 是 DO / DTO / BO / VO 的统称，禁止命名成 xxxPOJO。
    - 方法名、参数名、成员变量、局部变量都统一使用 lowerCamelCase 风格。
    - 常量命名应该全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。
    - 抽象类命名使用 Abstract 或 Base 开头;异常类命名使用 Exception 结尾，测试类命名以它要测试的类的名称开始，以 Test 结尾。
    - POJO 类中的任何布尔类型的变量，都不要加 is 前缀，否则部分框架解析会引起序列化错误。
    - 包名统一使用小写，点分隔符之间有且仅有一个自然语义的英语单词。包名统一使用单数形式，但是类名如果有复数含义，类名可以使用复数形式。
    - 避免在子父类的成员变量之间、或者不同代码块的局部变量之间采用完全相同的命名，使可理解性降低。

### 常量定义

- 强制
    - 不允许任何魔法值(即未经预先定义的常量)直接出现在代码中。
    - long 或 Long 赋值时，数值后使用大写 L，不能是小写 l，小写容易跟数字混淆，造成误解。
    - 浮点数类型的数值后缀统一为大写的 D 或 F。
- 推荐
    - 不要使用一个常量类维护所有常量，要按常量功能进行归类，分开维护。
    - 常量的复用层次有五层:跨应用共享常量、应用内共享常量、子工程内共享常量、包内共享常量、类内共享常量。
        - 跨应用共享常量:放置在二方库中，通常是 client.jar 中的 constant 目录下。
        - 应用内共享常量:放置在一方库中，通常是子模块中的 constant 目录下。
        - 子工程内部共享常量:即在当前子工程的 constant 目录下。
        - 包内共享常量:即在当前包下单独的 constant 目录下。
        - 类内共享常量:直接在类内部 private static final 定义。
    - 如果变量值仅在一个固定范围内变化用 enum 类型来定义。

### 代码格式

- 强制
    - IDE 的 text file encoding 设置为 UTF-8；IDE 中文件的换行符使用 Unix 格式，不要使用 Windows 格式。
    - 如果大括号内为空，简洁地写成{}即可，大括号中间无需换行和空格。
    - 逗号后空格。
    - 注释标记后空格。
    - 操作符前后空格。
    - 方法调用的括号前后不空格。
    - 采用 2 个空格缩进，缩进使用空格而不是 Tab。
    - 左小括号和右边相邻字符之间不需要空格。
    - if / for / while / switch / do 等保留字与左右括号之间都必须加空格。
    - 任何二目、三目运算符的左右两边都需要加一个空格。
    - 在进行类型强制转换时，右括号与强制转换值之间不需要任何空格隔开。
    - 每行不得超过 120 列。
    - 方法参数在定义和传入时，多个参数逗号后面必须加空格。
- 推荐
    - 不同逻辑、不同语义、不同业务的代码之间插入一个空行，分隔开来以提升可读性。

### OOP 规约

- 强制
    - 避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成本，直接用类名来访问即可。
    - 所有的覆写方法，必须加 @Override 注解。
    - 相同参数类型，相同业务含义，才可以使用的可变参数，参数类型避免定义为 Object。
    - 外部正在调用的接口或者二方库依赖的接口，不允许修改方法签名，避免对接口调用方产生影响。接口过时必须加 @Deprecated 注解，并清晰地说明采用的新接口或者新服务是什么。
    - 所有整型包装类对象之间值的比较，全部使用 equals 方法比较。
    - 任何货币金额，均以最小货币单位且为整型类型进行存储。
    - 浮点数之间的等值判断，基本数据类型不能使用 == 进行比较，包装数据类型不能使用 equals 进行判断。
    - BigDecimal 的等值比较应使用 compareTo() 方法，而不是 equals() 方法。
    - 定义数据对象 DO 类时，属性类型要与数据库字段类型相匹配。
    - 禁止使用构造方法 BigDecimal(double) 的方式把 double 值转化为 BigDecimal 对象。
    - 关于基本数据类型与包装数据类型的使用标准如下:
        - 所有的 POJO 类属性必须使用包装数据类型。
        - RPC 方法的返回值和参数必须使用包装数据类型。
        - 所有的局部变量使用基本数据类型。
    - 定义 DO / PO / DTO / VO 等 POJO 类时，不要设定任何属性默认值。
    - 序列化类新增属性时，请不要修改 serialVersionUID 字段，避免反序列失败;如果完全不兼容升级，避免反序列化混乱，那么请修改 serialVersionUID 值。
    - 构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中。
    - POJO 类必须写 toString 方法。使用 IDE 中的工具 source > generate toString 时，如果继
    - 禁止在 POJO 类中，同时存在对应属性 xxx 的 isXxx() 和 getXxx() 方法。
- 推荐
    - 当一个类有多个构造方法，或者多个同名方法，这些方法应该按顺序放置在一起，便于阅读。
    - 类内方法定义的顺序依次是:公有方法或保护方法 > 私有方法 > getter / setter 方法。
    - setter 方法中，参数名称与类成员变量名称一致，this.成员名=参数名。在 getter / setter 方法中，不要增加业务逻辑，增加排查问题的难度。
    - 循环体内，字符串的连接方式，使用 StringBuilder 的 append 方法进行扩展。
    - final 可以声明类、成员变量、方法、以及本地变量，下列情况使用 final 关键字:
        - 不允许被继承的类，如:String 类。
        - 不允许修改引用的域对象，如:POJO 类的域变量。
        - 不允许被覆写的方法，如:POJO 类的 setter 方法。
        - 不允许运行过程中重新赋值的局部变量。
        - 避免上下文重复使用一个变量，使用 final 关键字可以强制重新定义一个变量，方便更好地进行重构。
    - 慎用 Object 的 clone 方法来拷贝对象。
    - 类成员与方法访问控制从严:
        - 如果不允许外部直接通过 new 来创建对象，那么构造方法必须是 private。
        - 工具类不允许有 public 或 default 构造方法。
        - 类非 static 成员变量并且与子类共享，必须是 protected。
        - 类非 static 成员变量并且仅在本类使用，必须是 private。
        - 类 static 成员变量如果仅在本类使用，必须是 private。
        - 若是 static 成员变量，考虑是否为 final。
        - 类成员方法只供类内部调用，必须是 private。
        - 类成员方法只对继承类公开，那么限制为 protected。
            - 数据对象:xxxDO，xxx 即为数据表名。
            - 数据传输对象:xxxDTO，xxx 为业务领域相关的名称。
            - 展示对象:xxxVO，xxx 一般为网页名称。
            - POJO 是 DO / DTO / BO / VO 的统称，禁止命名成 xxxPOJO。
